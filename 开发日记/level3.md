# 编写守护进程

[^level3]: 2019.7.16  14:00

因为多进程的程序中需要有一个master进程作为守护进程来管理多进程，因此，这一部分先加入守护进程的创建函数，具体创建方法参考apue，具体函数为process/process.cc/flyd_daemon



## 守护进程特点

1. PPID = 1;  父进程为init进程，或者为0（内核进程），因此只要操作系统启动了，它就会启动

2. tty = ?;   不与任何的终端关联

3. uid = 0; 以超级用户特权运行

4. 是进程组的组长进程以及会话的首进程，而且是唯一进程

   ## 编程规则

   **1. umask(0)**: 设置允许守护进程创建文件或者目录最大可操作的权限。就是给予一切文件权限。

   **2. 调用fork()创建进程，然后父进程退出**：使得PPID = 1，父进程退出，由init接管进程。

   **3.调用setsid创建新的会话**：做到三点：a)成为会话的首进程；b)成为进程组的组长进程；c)解除与终端的联系

   **4.将当前的工作目录更改为根目录**：防止守护进程出现在装配文件中，会导致其不可拆卸。

   **5.关闭不再需要的文件描述符**：这使得守护进程不再拥有从父进程继承得到的文件描述符。

   **6.打开dev/null，重定向标准输入，标准输出，以及标准错误**：因为守护进程不与终端发生关系，因此也就不能将守护进程的输入输出与终端联系。出错记录应该用单独的记录文件。

